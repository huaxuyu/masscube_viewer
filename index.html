<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Peak Shape Plotter (RT vs Intensity)</title>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <style>
    :root { --brand: #4f46e5; }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 24px; background:#f7f7fb;
      font-family: Arial, Helvetica, sans-serif; color:#111827;
    }
    .container { max-width: 1100px; margin: 0 auto; }
    h1 { margin: 0 0 8px; font-size: 28px; }
    p.sub { margin: 0 0 18px; color:#6b7280; }
    .card {
      background:#fff; border:1px solid #e5e7eb; border-radius:16px;
      box-shadow: 0 1px 2px rgba(16,24,40,0.06);
      margin-bottom: 18px; overflow:hidden;
    }
    .card .header { padding: 14px 16px; border-bottom:1px solid #e5e7eb; }
    .card .title { font-weight: 600; }
    .card .content { padding:16px; }
    textarea {
      width:100%; height:190px; border:1px solid #d1d5db; border-radius:12px;
      padding:10px; font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size:12px; outline: none;
    }
    textarea:focus { border-color: var(--brand); box-shadow: 0 0 0 3px rgba(79,70,229,0.2); }
    .row { display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
    .btn {
      appearance:none; border:1px solid #d1d5db; background:#fff; color:#111827;
      padding:10px 14px; border-radius:14px; cursor:pointer;
      transition: box-shadow .15s ease, transform .02s; font-weight:600;
    }
    .btn:hover { box-shadow:0 2px 8px rgba(16,24,40,.08); }
    .btn:active { transform: translateY(1px); }
    .btn.primary { background: var(--brand); color:#fff; border-color: var(--brand); }
    #chart { width:100%; height: 480px; }
    .tips { color:#6b7280; font-size: 14px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Peak Shape Plotter</h1>
    <p class="sub">Paste pairs formatted as <code>retention time; intensity</code> separated by <code>|</code>. Example is pre-filled.</p>

    <div class="card">
      <div class="header"><span class="title">Input</span></div>
      <div class="content">
        <textarea id="input">0.345;1734.0|0.35;0.0|0.356;1540.0|0.361;1626.0|0.367;0.0|0.373;0.0|0.379;0.0|0.384;0.0|0.39;0.0|0.396;1844.0|0.402;6438.0|0.408;17224.0|0.414;76831.0|0.419;348218.0|0.425;1363274.0|0.43;3546673.0|0.436;4264408.0|0.441;3867371.0|0.446;2299352.0|0.451;1060007.0|0.457;587157.0|0.462;485618.0|0.468;485247.0|0.474;419401.0|0.48;235657.0|0.486;125483.0|0.492;68722.0|0.498;35809.0|0.504;20858.0|0.514;7069.0|0.519;4055.0|0.526;3917.0|0.533;3987.0|0.54;3552.0|0.546;2906.0|0.553;5973.0|0.559;6792.0|0.565;7409.0|0.572;5049.0|0.578;5166.0|0.584;4902.0|0.59;4233.0|0.595;3567.0|0.6;2507.0|0.606;3216.0|0.611;3580.0|0.617;3177.0|0.622;4045.0|0.628;3398.0|0.634;3446.0|0.641;3683.0|0.647;4393.0|0.654;3546.0|0.66;3384.0|0.666;3248.0|0.672;2918.0|0.678;2599.0|0.683;2564.0|0.689;2284.0|0.695;2404.0|0.701;2607.0|0.707;2245.0|0.714;1581.0|0.72;1693.0|0.726;2373.0|0.733;1375.0|0.739;0.0|0.745;0.0|0.752;0.0|0.758;0.0|0.763;0.0|0.77;1218.0</textarea>
        <div class="row" style="margin-top:10px">
          <button id="plotBtn" class="btn primary">Plot</button>
          <button id="pngBtn" class="btn">Download PNG</button>
          <button id="csvBtn" class="btn">Download CSV</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="header"><span class="title">Peak (RT vs Intensity)</span></div>
      <div class="content">
        <div id="chart" aria-label="RT vs Intensity area chart"></div>
      </div>
    </div>

    <p class="tips">Tips: keep the delimiter pattern <code>rt;intensity</code> with vertical bars <code>|</code>. Lines are sorted by RT automatically; nonâ€‘numeric pairs are ignored.</p>
  </div>

  <script>
    function parsePairs(input) {
      return input.trim().split('|')
        .map(s => s.trim()).filter(Boolean)
        .map(p => {
          const [rt, y] = p.split(';').map(v => Number(String(v).trim()));
          return { rt, intensity: y };
        })
        .filter(d => Number.isFinite(d.rt) && Number.isFinite(d.intensity))
        .sort((a,b) => a.rt - b.rt);
    }

    function toCSV(rows) {
      const header = 'rt,intensity';
      const lines = rows.map(r => `${r.rt},${r.intensity}`);
      return [header, ...lines].join('\n');
    }

    function plot() {
      const raw = document.getElementById('input').value;
      const data = parsePairs(raw);
      if (!data.length) return;

      const x = data.map(d => d.rt);
      const y = data.map(d => d.intensity);

      const trace = {
        x, y, type: 'scatter', mode: 'lines',
        line: { width: 2, color: getComputedStyle(document.documentElement).getPropertyValue('--brand').trim() },
        fill: 'tozeroy', name: 'Intensity'
      };

      const maxY = Math.max(0, ...y);
      const layout = {
        margin: { l: 70, r: 20, t: 10, b: 50 },
        xaxis: {
          title: { text: 'Retention time', standoff: 10, font: { family: 'Arial, Helvetica, sans-serif' } },
          tickfont: { family: 'Arial, Helvetica, sans-serif' },
          zeroline: false
        },
        yaxis: {
          title: { text: 'Intensity', standoff: 15, font: { family: 'Arial, Helvetica, sans-serif' } },
          tickfont: { family: 'Arial, Helvetica, sans-serif' },
          rangemode: 'tozero',
          separatethousands: true,
          automargin: true
        },
        paper_bgcolor: '#ffffff',
        plot_bgcolor: '#ffffff'
      };

      const config = {
        responsive: true,
        displaylogo: false,
        toImageButtonOptions: { filename: 'peak', format: 'png', scale: 2 }
      };

      Plotly.newPlot('chart', [trace], layout, config);
    }

    function downloadPNG() {
      Plotly.toImage('chart', {format:'png', scale:2, filename:'peak'}).then((url) => {
        const a = document.createElement('a');
        a.href = url;
        a.download = 'peak.png';
        a.click();
      });
    }

    function downloadCSV() {
      const raw = document.getElementById('input').value;
      const data = parsePairs(raw);
      const csv = toCSV(data);
      const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'peak.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    document.getElementById('plotBtn').addEventListener('click', plot);
    document.getElementById('pngBtn').addEventListener('click', downloadPNG);
    document.getElementById('csvBtn').addEventListener('click', downloadCSV);
    document.getElementById('input').addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') plot();
    });

    // initial render
    plot();
  </script>
</body>
</html>
