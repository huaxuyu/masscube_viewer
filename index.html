<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Peak Shape Plotter (RT vs Intensity)</title>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <style>
      :root {
        --brand: #4f46e5;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        padding: 24px;
        background: #f7f7fb;
        font-family: Arial, Helvetica, sans-serif;
        color: #111827;
      }
      .container {
        max-width: 1100px;
        margin: 0 auto;
      }
      h1 {
        margin: 0 0 8px;
        font-size: 28px;
      }
      p.sub {
        margin: 0 0 18px;
        color: #6b7280;
      }
      .card {
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 16px;
        box-shadow: 0 1px 2px rgba(16, 24, 40, 0.06);
        margin-bottom: 18px;
        overflow: hidden;
      }
      .card .header {
        padding: 14px 16px;
        border-bottom: 1px solid #e5e7eb;
      }
      .card .title {
        font-weight: 600;
      }
      .card .content {
        padding: 16px;
      }
      textarea {
        width: 100%;
        height: 190px;
        border: 1px solid #d1d5db;
        border-radius: 12px;
        padding: 10px;
        font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
        font-size: 16px;
        outline: none;
      }
      textarea:focus {
        border-color: var(--brand);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }
      .btn {
        appearance: none;
        border: 1px solid #d1d5db;
        background: #fff;
        color: #111827;
        padding: 10px 14px;
        border-radius: 14px;
        cursor: pointer;
        transition: box-shadow 0.15s ease, transform 0.02s;
        font-weight: 600;
      }
      .btn:hover {
        box-shadow: 0 2px 8px rgba(16, 24, 40, 0.08);
      }
      .btn:active {
        transform: translateY(1px);
      }
      .btn.primary {
        background: var(--brand);
        color: #fff;
        border-color: var(--brand);
      }
      #chart {
        width: 100%;
        height: 480px;
      }
      .tips {
        color: #6b7280;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Peak Shape Plotter</h1>
      <p class="sub">
        Paste pairs formatted as
        <code>retention time; intensity</code> separated by <code>|</code>.
        Example is pre-filled.
      </p>

      <div class="card">
        <div class="header"><span class="title">Input</span></div>
        <div class="content">
          <textarea id="input">
1.476;1616.0|1.482;4424.0|1.487;17358.0|1.493;56188.0|1.498;136646.0|1.504;167521.0|1.509;160536.0|1.515;102560.0|1.52;58320.0|1.525;21360.0|1.531;6971.0|1.537;2735.0|1.542;1732.0|1.548;1111.0|</textarea
          >
          <div class="row" style="margin-top: 10px">
            <button id="plotBtn" class="btn primary">Plot</button>
            <button id="pngBtn" class="btn">Download PNG</button>
            <button id="csvBtn" class="btn">Download CSV</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="header">
          <span class="title">Peak (RT vs Intensity)</span>
        </div>
        <div class="content">
          <div id="chart" aria-label="RT vs Intensity area chart"></div>
        </div>
      </div>

      <p class="tips">
        Tips: keep the delimiter pattern <code>rt;intensity</code> with vertical
        bars <code>|</code>. Lines are sorted by RT automatically; nonâ€‘numeric
        pairs are ignored.
      </p>
    </div>

    <script>
      function parsePairs(input) {
        return input
          .trim()
          .split("|")
          .map((s) => s.trim())
          .filter(Boolean)
          .map((p) => {
            const [rt, y] = p.split(";").map((v) => Number(String(v).trim()));
            return { rt, intensity: y };
          })
          .filter((d) => Number.isFinite(d.rt) && Number.isFinite(d.intensity))
          .sort((a, b) => a.rt - b.rt);
      }

      function toCSV(rows) {
        const header = "rt,intensity";
        const lines = rows.map((r) => `${r.rt},${r.intensity}`);
        return [header, ...lines].join("\n");
      }

      function plot() {
        const raw = document.getElementById("input").value;
        const data = parsePairs(raw);
        if (!data.length) return;

        const x = data.map((d) => d.rt);
        const y = data.map((d) => d.intensity);

        const trace = {
          x,
          y,
          type: "scatter",
          mode: "lines",
          line: {
            width: 2,
            color: getComputedStyle(document.documentElement)
              .getPropertyValue("--brand")
              .trim(),
          },
          fill: "tozeroy",
          name: "Intensity",
        };

        const maxY = Math.max(0, ...y);
        const layout = {
          margin: { l: 70, r: 20, t: 10, b: 60 },
          xaxis: {
            title: {
              text: "Retention time (min)",
              standoff: 32,
              font: { family: "Arial, Arial, sans-serif", size: 24 },
            },
            tickfont: { family: "Arial, Arial, sans-serif", size: 18 },
            zeroline: false,
            showline: true,
            linecolor: "#000",
            linewidth: 2,
            ticks: "outside",
            tickcolor: "#000",
            tickwidth: 1,
            ticklen: 6,
            zeroline: false, // optional: hide horizontal zero line
          },
          yaxis: {
            title: {
              text: "Intensity",
              standoff: 16,
              font: { family: "Arial, Arial, sans-serif", size: 24 },
            },
            tickfont: { family: "Arial, Arial, sans-serif", size: 18 },
            rangemode: "tozero",
            separatethousands: true,
            automargin: true,
            showline: true,
            linecolor: "#000",
            linewidth: 2,
            ticks: "outside",
            tickcolor: "#000",
            tickwidth: 1,
            ticklen: 6,
            zeroline: false, // optional: hide horizontal zero line
          },
          paper_bgcolor: "#ffffff",
          plot_bgcolor: "#ffffff",
        };

        const config = {
          responsive: true,
          displaylogo: false,
          toImageButtonOptions: { filename: "peak", format: "png", scale: 2 },
        };

        Plotly.newPlot("chart", [trace], layout, config);
      }

      function downloadPNG() {
        Plotly.toImage("chart", {
          format: "png",
          scale: 2,
          filename: "peak",
        }).then((url) => {
          const a = document.createElement("a");
          a.href = url;
          a.download = "peak.png";
          a.click();
        });
      }

      function downloadCSV() {
        const raw = document.getElementById("input").value;
        const data = parsePairs(raw);
        const csv = toCSV(data);
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "peak.csv";
        a.click();
        URL.revokeObjectURL(url);
      }

      document.getElementById("plotBtn").addEventListener("click", plot);
      document.getElementById("pngBtn").addEventListener("click", downloadPNG);
      document.getElementById("csvBtn").addEventListener("click", downloadCSV);
      document.getElementById("input").addEventListener("keydown", (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === "Enter") plot();
      });

      // initial render
      plot();
    </script>
  </body>
</html>
